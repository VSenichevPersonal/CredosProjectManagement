# üóÑÔ∏è –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- ‚úÖ **Seed Database** - –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚ö†Ô∏è **Reset Database** - –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ë–î

## üéØ –î–æ—Å—Ç—É–ø

### –ß–µ—Ä–µ–∑ Web UI (Admin Panel)
1. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `/admin`
3. –í–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–∞–Ω–µ–ª—å "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö"

### –ß–µ—Ä–µ–∑ API

#### Seed Database
```bash
POST /api/admin/seed-db
Content-Type: application/json
Cookie: <admin-session>

# –û—Ç–≤–µ—Ç:
{
  "success": true,
  "message": "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏",
  "stats": {
    "directions": 5,
    "employees": 10,
    "projects": 5,
    "tasks": 10,
    "timeEntries": 35
  }
}
```

#### Reset Database
```bash
POST /api/admin/reset-db
Content-Type: application/json
Cookie: <admin-session>

{
  "confirm": "–£–î–ê–õ–ò–¢–¨ –í–°–ï –î–ê–ù–ù–´–ï"
}

# –û—Ç–≤–µ—Ç:
{
  "success": true,
  "message": "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω–∞",
  "warning": "–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã! –î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ seed.",
  "deletedTables": [
    "time_entries",
    "tasks",
    "projects",
    "user_roles",
    "employees",
    "directions",
    "revenue_manual",
    "salary_register"
  ]
}
```

### –ß–µ—Ä–µ–∑ Shell Scripts

```bash
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
./scripts/test-seed-api.sh

# –û—á–∏—Å—Ç–∏—Ç—å –ë–î (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
./scripts/test-reset-api.sh
```

## üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### Seed —Å–æ–∑–¥–∞—ë—Ç:

**–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (5)**
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (IB)
- –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è –ò–ë (PIB)
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥ (CONS)
- –ê—É–¥–∏—Ç (AUDIT)
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (DEV)

**–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (10)**
- admin@credos.ru - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –°–∏—Å—Ç–µ–º—ã
- ivanov.ii@credos.ru - –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ò–ë
- petrov.pp@credos.ru - –í–µ–¥—É—â–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –ò–ë
- sidorov.ss@credos.ru - –ò–Ω–∂–µ–Ω–µ—Ä –ü–ò–ë
- kuznetsov.ak@credos.ru - –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∞—É–¥–∏—Ç—É
- –ò –µ—â—ë 5 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...

**–ü—Ä–æ–µ–∫—Ç—ã (5)**
- –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –°–≠–î (SED-2024)
- –ê—É–¥–∏—Ç –ò–ë –ë–∞–Ω–∫–∞ (AUDIT-BANK)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SIEM (SIEM-2024)
- –ó–∞—â–∏—Ç–∞ –ê–°–£ –¢–ü (PIB-SCADA)
- –ü–µ–Ω—Ç–µ—Å—Ç –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (PENTEST-WEB)

**–ó–∞–¥–∞—á–∏ (10+)**
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º
- –†–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã: todo, in_progress, completed
- –†–∞–∑–ª–∏—á–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: low, medium, high, critical

**Time Entries (~35)**
- –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π
- 6-8 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- –°–≤—è–∑–∞–Ω—ã —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏

## ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- –û–±–∞ endpoint —Ç—Ä–µ–±—É—é—Ç —Ä–æ–ª—å `admin`
- Reset —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ body
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚ùå **–ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ production!**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ dev/staging
- ‚úÖ –î–µ–ª–∞—Ç—å backup –ø–µ—Ä–µ–¥ reset
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
src/app/api/admin/
‚îú‚îÄ‚îÄ seed-db/route.ts      # API endpoint –¥–ª—è seed
‚îî‚îÄ‚îÄ reset-db/route.ts     # API endpoint –¥–ª—è reset

src/components/admin/
‚îî‚îÄ‚îÄ database-management-panel.tsx  # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

src/app/(dashboard)/admin/
‚îî‚îÄ‚îÄ page.tsx              # –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ seed

1. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ON CONFLICT DO UPDATE` –∏–ª–∏ `DO NOTHING`
   - –ù–µ —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã

2. **–ü–æ—Ä—è–¥–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è**:
   1. Directions (–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ)
   2. Employees (–∑–∞–≤–∏—Å—è—Ç –æ—Ç directions)
   3. Projects (–∑–∞–≤–∏—Å—è—Ç –æ—Ç directions, employees)
   4. Tasks (–∑–∞–≤–∏—Å—è—Ç –æ—Ç projects, employees)
   5. Time Entries (–∑–∞–≤–∏—Å—è—Ç –æ—Ç employees, projects)

3. **Realistic Data**:
   - –†–µ–∞–ª—å–Ω—ã–µ email-–∞–¥—Ä–µ—Å–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ @credos.ru
   - –û—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤
   - –°–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
   - –¢–æ–ª—å–∫–æ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ (–ø–Ω-–ø—Ç)

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ reset

1. **Cascading Deletes**: –£–¥–∞–ª–µ–Ω–∏–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
   ```sql
   time_entries ‚Üí tasks ‚Üí projects ‚Üí employees ‚Üí directions
   ```

2. **Foreign Key Safety**: –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ FK constraints

3. **–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã**: –ù–ï —É–¥–∞–ª—è–µ—Ç auth.user –∏ –¥—Ä—É–≥–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ

## üß™ –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–∞—á–∞–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# 1. –û—á–∏—Å—Ç–∏—Ç—å –ë–î –æ—Ç —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
./scripts/test-reset-api.sh

# 2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–≤–µ–∂–∏–º–∏ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
./scripts/test-seed-api.sh

# 3. –ù–∞—á–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞
npm run dev
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
```bash
# 1. Seed –¥–∞—ë—Ç –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
./scripts/test-seed-api.sh

# 2. –í—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∞
# —á–µ—Ä–µ–∑ UI –∏–ª–∏ –ø—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã

# 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

# 4. Reset –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞
./scripts/test-reset-api.sh
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–µ–º–æ –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–∞
```bash
# 1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞–±–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
./scripts/test-seed-api.sh

# 2. –ü—Ä–æ–≤–µ—Å—Ç–∏ –¥–µ–º–æ

# 3. –ü–æ—Å–ª–µ –¥–µ–º–æ - –æ—á–∏—Å—Ç–∏—Ç—å
./scripts/test-reset-api.sh
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ ExecutionContext:

```typescript
ctx.logger.info('[Admin] Seed DB request')
ctx.logger.warn('[Admin] Reset DB request - DANGEROUS OPERATION')
ctx.logger.info('[Admin] Created 10 employees')
```

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–æ—à–ª–∏ –∫–∞–∫ admin
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–ª—å –≤ —Ç–∞–±–ª–∏—Ü–µ `user_roles`

### –û—à–∏–±–∫–∞: "–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏"
- –î–ª—è reset –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `{"confirm": "–£–î–ê–õ–ò–¢–¨ –í–°–ï –î–ê–ù–ù–´–ï"}`

### –û—à–∏–±–∫–∞: Foreign key constraint
- Reset —É–¥–∞–ª—è–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å FK

### Seed –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ
- –í–æ–∑–º–æ–∂–Ω–æ –¥–∞–Ω–Ω—ã–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç (ON CONFLICT)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. ‚ú® –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–Ω—ã–µ seed profiles (small/medium/large)
2. ‚ú® –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç snapshot'–æ–≤ –ë–î
3. ‚ú® Partial reset (—Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã)
4. ‚ú® Seed —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ —Ç.–¥.)
5. ‚ú® UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ë–î

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2024  
**–í–µ—Ä—Å–∏—è:** 1.0

