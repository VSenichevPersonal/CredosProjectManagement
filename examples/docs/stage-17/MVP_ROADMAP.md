# MVP Roadmap: Мастер генерации документов ПДн

**Цель:** Рабочий MVP с реальной генерацией документов  
**Срок:** 9-12 дней  
**Дата старта:** 14 октября 2025

---

## 🎯 MVP SCOPE

### ✅ Включено в MVP

- ✅ UI мастера (готово!)
- ✅ Реальная генерация через Claude 4.5
- ✅ Пакет "152-ФЗ ПДн" (3 документа)
- ✅ Сохранение в библиотеку документов
- ✅ Экспорт в DOCX
- ✅ Базовая валидация качества

### ❌ НЕ включено в MVP

- ❌ Монетизация / Оплата
- ❌ Human провайдер (эксперты)
- ❌ Fine-tuned модель
- ❌ Уточняющие вопросы от LLM
- ❌ База знаний
- ❌ Редактирование в браузере

---

## 📅 ПЛАН ПО СПРИНТАМ

### 🏃 Спринт 1: Backend основа (3 дня)

**14 октября (День 1): БД и типы**
```
✅ Миграция document_packages
✅ Миграция document_generation_sessions
✅ Миграция session_documents
✅ Типы: DocumentPackage, GenerationSession
✅ Провайдеры: CRUD для пакетов и сессий
✅ Seed данные: пакет "152-ФЗ ПДн"
```

**15 октября (День 2): API**
```
✅ GET /api/document-packages
✅ GET /api/document-packages/:id
✅ POST /api/document-wizard (создать сессию)
✅ PATCH /api/document-wizard/:id/answers (сохранить ответы)
✅ POST /api/document-wizard/:id/generate (запустить генерацию)
```

**16 октября (День 3): Подключение UI**
```
✅ Заменить mock пакетов на API
✅ Заменить mock сессии на API
✅ Обработка ошибок
✅ Loading states
```

**Результат:** UI работает с реальной БД ✅

---

### 🏃 Спринт 2: LLM генерация (3-4 дня)

**17 октября (День 4): Промпт-инжиниринг**
```
✅ Системный промпт для 152-ФЗ
✅ Промпт для Политики ПДн
✅ Промпт для Инструкции ПДн
✅ Промпт для ОРД
✅ Тестирование в Claude Playground
```

**18 октября (День 5): Интеграция Claude**
```
✅ DocumentGenerationService.generateDocument()
✅ Маппинг answers → промпт
✅ Вызов Claude API
✅ Парсинг ответа
✅ Обработка ошибок (retry, fallback)
```

**19 октября (День 6): Сохранение результатов**
```
✅ Создание Document в таблице evidence
✅ Создание DocumentVersion
✅ Связь session → documents
✅ Обновление статуса сессии
```

**20 октября (День 7, опц.): Качество**
```
✅ Расчёт confidence score
✅ Валидация структуры документа
✅ Повторная генерация при низком качестве
```

**Результат:** Реальная генерация работает ✅

---

### 🏃 Спринт 3: Экспорт и полировка (2-3 дня)

**21 октября (День 8): Экспорт DOCX**
```
✅ Интеграция библиотеки docx
✅ Парсинг Markdown → DOCX
✅ API: GET /api/documents/:id/export/docx
✅ Кнопка скачивания в UI
```

**22 октября (День 9): UI полировка**
```
✅ Улучшение UX (тултипы, подсказки)
✅ Обработка edge cases
✅ Мобильная версия
✅ Исправление багов
```

**23 октября (День 10, опц.): Тестирование**
```
✅ E2E тест мастера
✅ Тестирование на реальных данных
✅ Проверка качества документов
✅ Исправление найденных проблем
```

**Результат:** Полноценный рабочий MVP ✅

---

## 📊 TIMELINE

```
┌─────────────────────────────────────────────────────┐
│ Сегодня 13.10       │ ████████ UI готов            │
├─────────────────────────────────────────────────────┤
│ Спринт 1: 14-16.10  │ ████████ Backend основа      │
├─────────────────────────────────────────────────────┤
│ Спринт 2: 17-20.10  │ ████████ LLM генерация       │
├─────────────────────────────────────────────────────┤
│ Спринт 3: 21-23.10  │ ████████ Экспорт + полировка │
├─────────────────────────────────────────────────────┤
│ MVP готов: 22-25.10 │ ✅ Рабочий продукт!          │
└─────────────────────────────────────────────────────┘

Оценка: 9-12 дней (+ 1-2 дня буфер)
```

---

## 🎯 КРИТЕРИИ ГОТОВНОСТИ MVP

### Функциональность

- [ ] Пользователь может выбрать пакет "152-ФЗ ПДн"
- [ ] Пользователь может заполнить анкету
- [ ] Система генерирует 3 документа через Claude
- [ ] Документы сохраняются в библиотеку
- [ ] Пользователь может скачать DOCX
- [ ] Генерация работает в 95%+ случаев
- [ ] Среднее время генерации < 10 минут

### Качество

- [ ] Средний confidence score > 85%
- [ ] Документы содержат реквизиты организации
- [ ] Документы соответствуют 152-ФЗ
- [ ] Нет placeholder'ов типа "[НАЗВАНИЕ]"
- [ ] 0 критических багов

### UX

- [ ] Понятная навигация
- [ ] Loading states везде
- [ ] Обработка ошибок
- [ ] Мобильная версия работает

---

## 📝 DAILY CHECKLIST

### День 1 (14.10): БД и типы
- [ ] Создать миграцию `001_document_packages.sql`
- [ ] Создать миграцию `002_document_generation_sessions.sql`
- [ ] Создать миграцию `003_session_documents.sql`
- [ ] Создать тип `DocumentPackage` в `types/domain/`
- [ ] Создать тип `GenerationSession` в `types/domain/`
- [ ] Добавить провайдеры в `providers/supabase/`
- [ ] Создать seed для пакета "152-ФЗ ПДн"
- [ ] Проверить что seed работает

### День 2 (15.10): API
- [ ] `GET /api/document-packages/route.ts`
- [ ] `GET /api/document-packages/[id]/route.ts`
- [ ] `POST /api/document-wizard/route.ts`
- [ ] `PATCH /api/document-wizard/[id]/answers/route.ts`
- [ ] `POST /api/document-wizard/[id]/generate/route.ts`
- [ ] Тесты API (Postman/Insomnia)

### День 3 (16.10): Подключение UI
- [ ] Заменить `documentPackages` на API в `new/page.tsx`
- [ ] Заменить `questionnaire152FZ` на API
- [ ] Создать сессию при переходе на `[id]/page.tsx`
- [ ] Сохранять answers через API
- [ ] Loading states + error handling
- [ ] Проверить что всё работает

### День 4 (17.10): Промпты
- [ ] Системный промпт для 152-ФЗ
- [ ] Промпт "Политика обработки ПДн"
- [ ] Промпт "Инструкция по обработке ПДн"
- [ ] Промпт "ОРД по ИСПДн"
- [ ] Протестировать в Claude Playground
- [ ] Собрать 5 вариантов ответов для теста

### День 5 (18.10): Claude интеграция
- [ ] Создать `services/document-generation-service.ts`
- [ ] Функция `generateDocument(template, answers)`
- [ ] Маппинг answers → промпт
- [ ] Вызов Claude API (через Vercel AI SDK)
- [ ] Парсинг ответа
- [ ] Retry механизм (3 попытки)
- [ ] Fallback на gpt-4o
- [ ] Тесты генерации

### День 6 (19.10): Сохранение
- [ ] Создать Document в таблице `evidence`
- [ ] Создать DocumentVersion
- [ ] Записать в `session_documents`
- [ ] Обновить статус сессии → 'completed'
- [ ] Обновить UI для отображения результатов

### День 7 (20.10): Качество (опц.)
- [ ] Функция расчёта confidence score
- [ ] Валидация структуры документа
- [ ] Проверка на placeholder'ы
- [ ] Повторная генерация при confidence < 70%

### День 8 (21.10): DOCX экспорт
- [ ] `npm install docx`
- [ ] Функция `exportToDocx(content, title)`
- [ ] Парсинг Markdown → DOCX структура
- [ ] API endpoint `GET /api/documents/[id]/export/docx`
- [ ] Кнопка скачивания в UI
- [ ] Тест экспорта

### День 9 (22.10): UI полировка
- [ ] Тултипы для сложных полей
- [ ] Примеры заполнения
- [ ] Проверка мобильной версии
- [ ] Исправление багов
- [ ] Тестирование на разных браузерах

### День 10 (23.10): Тестирование (опц.)
- [ ] E2E тест мастера (Playwright)
- [ ] 10 разных организаций тест
- [ ] Проверка качества документов
- [ ] Сбор фидбека от тестировщиков
- [ ] Исправление критических багов

---

## 🚨 РИСКИ

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Claude API нестабилен | Средняя | Высокое | Retry + fallback на GPT-4o |
| Низкое качество генерации | Средняя | Критическое | Тщательный промпт-инжиниринг |
| DOCX экспорт сложный | Низкая | Среднее | Библиотека docx, fallback PDF |
| Превышение бюджета Claude | Высокая | Среднее | Лимиты 10 генераций/день для бета |

---

## 📈 МЕТРИКИ MVP

**Запустим сбор метрик после релиза:**

- Количество генераций
- Успешность генерации (%)
- Среднее время генерации
- Средний confidence score
- Скачивания DOCX
- Сохранения в библиотеку
- NPS (Net Promoter Score)

---

## ✅ DEFINITION OF DONE

**MVP считается готовым когда:**

1. ✅ Все функции из "MVP SCOPE" реализованы
2. ✅ Все пункты "КРИТЕРИИ ГОТОВНОСТИ" выполнены
3. ✅ 0 критических и блокирующих багов
4. ✅ Протестировано на 10+ разных организациях
5. ✅ Документация обновлена
6. ✅ Готово к показу реальным пользователям

---

**Статус:** 📋 План утверждён, начинаем 14 октября!  
**Next:** День 1 - БД и типы

🚀 **LET'S GO!**

