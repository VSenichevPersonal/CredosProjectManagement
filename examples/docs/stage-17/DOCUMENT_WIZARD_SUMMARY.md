# Мастер генерации документов - Краткая сводка

**Дата:** 13 октября 2025  
**Stage:** 17

---

## 🎯 ЦЕЛЬ

Создать **мастер-анкету для генерации комплектов документов по ИБ** с использованием:
- LLM (Claude 4.5)
- Fine-tuned моделей (в будущем)
- Экспертов-интеграторов (за деньги)

---

## 📊 ТЕКУЩЕЕ СОСТОЯНИЕ

### ✅ Что УЖЕ есть

```
Documents
├─ Document (отдельная сущность)
├─ DocumentVersion (версионирование)
├─ DocumentService
├─ DocumentAnalysisService (LLM анализ diff)
└─ Связь с Evidence через documentId

Evidence
├─ Может ссылаться на Document
├─ Many-to-many с ControlMeasure
└─ EvidenceLinkService

LLM
├─ OpenAI gpt-4o
├─ Anthropic Claude 4.5 ⭐
└─ Анализ изменений документов

Workflow
├─ WorkflowDefinition
├─ Поддержка типа 'document'
└─ Approval workflows
```

### ❌ Чего НЕТ

```
- Генерация документов из шаблонов
- Мастер/визард с анкетой
- Уточняющие вопросы от LLM
- Провайдерная модель (LLM / Human / Fine-tuned)
- Структурированная база знаний
- Монетизация генерации
```

---

## 🏗️ АРХИТЕКТУРА РЕШЕНИЯ

### Схема мастера

```
┌─────────────────────────────────────────────────┐
│  ШАГ 1: Выбор пакета                           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │ КИИ кат.2│  │ 152-ФЗ   │  │ ФСТЭК    │     │
│  └──────────┘  └──────────┘  └──────────┘     │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│  ШАГ 2: Анкета (Общие вопросы)                 │
│  • Название организации                         │
│  • Тип организации                              │
│  • Категория КИИ                                │
│  • Количество сотрудников                       │
│  • ...                                          │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│  ШАГ 3: Уточняющие вопросы от LLM              │
│  ⚡ Claude 4.5 анализирует ответы               │
│  • "Какие ИСПДн используются?"                  │
│  • "Есть ли подключение к сети Интернет?"       │
│  • "Кто является владельцем информации?"        │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│  ШАГ 4: Выбор провайдера                       │
│  ┌──────────────────────────────────────────┐  │
│  │ 🤖 LLM (Claude 4.5)                      │  │
│  │ ⚡ 5-10 минут | 💰 500 руб              │  │
│  │ Автоматическая генерация                 │  │
│  └──────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────┐  │
│  │ 🧪 Fine-tuned Model (в разработке)      │  │
│  │ ⚡ 15-20 минут | 💰 1500 руб            │  │
│  │ Специализированная модель                │  │
│  └──────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────┐  │
│  │ 👤 Эксперт-интегратор                   │  │
│  │ ⏱️ 2-3 дня | 💰 15000 руб              │  │
│  │ Ручная проработка экспертом              │  │
│  └──────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│  ШАГ 5: Генерация / Оплата                     │
│  • Создание PaymentIntent                       │
│  • Запуск генерации                             │
│  • Мониторинг прогресса                         │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│  ШАГ 6: Предпросмотр и редактирование          │
│  📄 Политика ИБ                                 │
│  📄 Инструкция по управлению доступом           │
│  📄 Положение о защите информации               │
│  ✏️  Редактировать | 💾 Сохранить              │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│  ШАГ 7: Сохранение как Document                │
│  ✅ Документы сохранены                         │
│  ✅ Могут использоваться как Evidence           │
│  ✅ Версионирование работает                    │
└─────────────────────────────────────────────────┘
```

### Связи сущностей

```
DocumentPackage
├─ code: "kii-category-2"
├─ title: "Документы для КИИ категории 2"
├─ documentTemplateIds: [...]
└─ questionnaire: QuestionnaireDefinition

QuestionnaireDefinition
├─ sections: [...]
└─ questions: Question[]

DocumentGenerationWizard
├─ packageId
├─ answers: { questionId → answer }
├─ clarificationQuestions: ClarificationQuestion[]  ← От LLM
├─ clarificationAnswers: { ... }
├─ provider: 'llm' | 'finetuned' | 'human'
├─ status: 'draft' | 'clarifying' | 'pending' | 'processing' | 'completed'
└─ generatedDocuments: GeneratedDocument[]

GeneratedDocument
├─ templateId
├─ content  ← Сгенерированный текст
├─ confidence: 85%
└─ warnings: ["Проверьте реквизиты", ...]

Document (сохранённый)
├─ templateId  ← Откуда был сгенерирован
├─ organizationId
└─ versions: [DocumentVersion]
```

---

## 🔌 ПРОВАЙДЕРНАЯ АРХИТЕКТУРА

### Интерфейс

```typescript
interface DocumentGenerationProvider {
  name: string
  type: 'llm' | 'finetuned' | 'human'
  
  isAvailable(): Promise<boolean>
  getCapabilities(): ProviderCapability
  generateDocument(params): Promise<GeneratedDocument>
  estimateCost(params): Promise<Money>
  estimateTime(params): Promise<number>
}
```

### Провайдеры

```
┌──────────────────────────────────────────────┐
│ LLMDocumentGenerationProvider                │
│ • Claude 4.5 Sonnet (1M tokens!)             │
│ • Весь контекст: все шаблоны + НПА + БЗ     │
│ • Быстро: 5-10 минут                         │
│ • Дёшево: 500 руб                            │
└──────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│ FineTunedGenerationProvider (TODO)           │
│ • Дообученная модель для РФ комплаенса       │
│ • Точнее: знает специфику                   │
│ • Средне: 15-20 минут                        │
│ • Средне: 1500 руб                           │
└──────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│ HumanDocumentGenerationProvider              │
│ • Эксперт-интегратор вручную                 │
│ • Отлично: высшее качество                   │
│ • Долго: 2-3 дня                             │
│ • Дорого: 15000 руб                          │
└──────────────────────────────────────────────┘
```

---

## 📚 СТРУКТУРИРОВАННАЯ БАЗА ЗНАНИЙ

### Структура

```
База знаний "Как делать документы по ИБ"

📁 Типы документов
├─ 📄 Политики
│  ├─ Что такое политика ИБ
│  ├─ Структура политики
│  ├─ Обязательные разделы
│  └─ Шаблоны политик
├─ 📄 Инструкции
├─ 📄 Процедуры
└─ 📄 Акты

📁 Регуляторы
├─ 🏛️ ФСТЭК
│  ├─ 187-ФЗ (КИИ)
│  │  ├─ Категория 1
│  │  ├─ Категория 2
│  │  └─ Категория 3
│  └─ Приказы №17, №21, №239
├─ 🏛️ ФСБ
├─ 🏛️ Роскомнадзор (152-ФЗ)
└─ 🏛️ Минцифры

📁 Процессы
├─ Разработка
├─ Согласование
├─ Утверждение
└─ Актуализация

📁 Лучшие практики
├─ Как писать понятно
├─ Частые ошибки
└─ Кейсы
```

### Типы статей

```typescript
type DocumentKBType = 
  | 'guide'              // Руководство (как делать)
  | 'template_guide'     // Инструкция по шаблону
  | 'best_practice'      // Лучшие практики
  | 'checklist'          // Чек-лист
  | 'faq'                // FAQ
  | 'case_study'         // Кейс
  | 'legal_commentary'   // Комментарий к НПА
```

### Интеграция с мастером

```
Мастер → БЗ:

1. Подсказки при заполнении
   User: "Что такое категория КИИ?"
   → Открывает статью из БЗ

2. Контекст для LLM
   Claude загружает статьи БЗ как контекст
   → Более точная генерация

3. Валидация
   Проверка структуры документа по БЗ
   → "Отсутствует раздел 'Термины'"

4. Рекомендации
   "Для вашего типа организации рекомендуем..."
   → Ссылки на статьи БЗ
```

---

## 💰 МОНЕТИЗАЦИЯ

### Тарифы

```
🤖 AI Генератор
├─ Базовая цена: 500 руб
├─ За документ: +100 руб
├─ Время: 5-10 минут
└─ Неограниченные правки

👤 Эксперт-интегратор
├─ Базовая цена: 15000 руб
├─ За документ: +3000 руб
├─ Время: 2-3 дня
├─ 1 итерация правок
└─ Консультация эксперта
```

### Workflow оплаты

```
Выбор провайдера
    ↓
Показ стоимости
    ↓
Создание PaymentIntent
    ↓
Оплата (YooKassa)
    ↓
Webhook: payment.succeeded
    ↓
Запуск генерации
```

---

## 📅 ПЛАН РЕАЛИЗАЦИИ

### MVP (10-13 дней)

```
✅ Фаза 1: Базовая инфраструктура (3-4 дня)
   • Типы данных
   • Схема БД
   • Сервисы
   • API

✅ Фаза 2: Мастер UI (4-5 дней)
   • Компоненты визарда
   • 7 шагов
   • Формы и валидация

✅ Фаза 3: LLM генерация (3-4 дня)
   • Промпт-инжиниринг
   • Интеграция Claude 4.5
   • Потоковая генерация
```

### Full Version (17-23 дня)

```
+ Фаза 4: База знаний (2-3 дня)
   • Структурированная БЗ
   • Редактор
   • Интеграция с мастером

+ Фаза 5: Монетизация (3-4 дня)
   • Интеграция с YooKassa
   • Human провайдер
   • Интерфейс для экспертов

+ Фаза 6: Полировка (2-3 дня)
   • Автосохранение
   • Предпросмотр
   • Экспорт DOCX
   • Тесты
```

---

## 🎯 КЛЮЧЕВЫЕ ПРЕИМУЩЕСТВА

### 1. Модульная архитектура

```
Провайдеры легко расширяются:
• Сегодня: LLM + Human
• Завтра: + Fine-tuned модель
• Послезавтра: + Внешний API
```

### 2. Использование Claude 4.5 (1M токенов!)

```
Можем загрузить в контекст:
✅ Все 100+ шаблонов документов
✅ Все НПА (187-ФЗ, 152-ФЗ, приказы)
✅ Всю базу знаний
✅ Примеры документов
✅ Контекст организации

= В ОДНОМ запросе!
```

### 3. Интеграция с существующей системой

```
Сгенерированные документы:
✅ Сохраняются как Document
✅ Могут использоваться как Evidence
✅ Связываются с ControlMeasure
✅ Версионирование работает
✅ Approval workflow работает
```

### 4. Монетизация

```
Источники дохода:
💰 Продажа пакетов документов
💰 Комиссия с экспертов
💰 Подписка на Premium (в будущем)
💰 API для интеграторов (в будущем)
```

---

## 🚀 СЛЕДУЮЩИЕ ШАГИ

### 1. Обсудить с пользователем

- [ ] Приоритеты функций
- [ ] Готовность к монетизации
- [ ] Какие регуляторы важнее
- [ ] Желаемые сроки

### 2. Получить пример анкеты

- [ ] Анкета GLy/
- [ ] Изучить структуру
- [ ] Адаптировать под нашу модель

### 3. Начать разработку

- [ ] Старт с Фазы 1 (инфраструктура)
- [ ] Создать первый пакет документов
- [ ] Интегрировать Claude 4.5

---

## 📖 ССЫЛКИ НА ДОКУМЕНТАЦИЮ

- 📄 **Полный анализ:** `DOCUMENT_GENERATION_WIZARD_ANALYSIS.md`
- 📄 **AI стратегия:** `AI_STRATEGY_FOR_DOCUMENTS.md`
- 📄 **README для LLM:** `../README_FOR_LLM.md`

---

**Готовы к старту? Жду анкету GLy/ и обсуждение приоритетов!** 🎉

