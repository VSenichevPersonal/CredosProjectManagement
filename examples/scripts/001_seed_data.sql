-- =====================================================
-- IB COMPLIANCE PLATFORM - SEED DATA
-- =====================================================
-- Начальные данные для работы системы

-- =====================================================
-- 0. СОЗДАНИЕ ДЕФОЛТНОГО TENANT
-- =====================================================

-- Создаем дефолтный tenant перед всеми остальными данными
INSERT INTO tenants (id, name, slug, description, is_active) VALUES
  ('00000000-0000-0000-0000-000000000000', 'Default Tenant', 'default', 'Дефолтный tenant для системы', true)
ON CONFLICT (id) DO NOTHING;

-- =====================================================
-- 1. СПРАВОЧНИКИ
-- =====================================================

-- Добавляем tenant_id во все INSERT запросы
-- Регуляторы
INSERT INTO regulators (tenant_id, name, short_name, description) VALUES
  ('00000000-0000-0000-0000-000000000000', 'Федеральная служба по техническому и экспортному контролю', 'ФСТЭК России', 'Федеральный орган исполнительной власти'),
  ('00000000-0000-0000-0000-000000000000', 'Федеральная служба безопасности', 'ФСБ России', 'Федеральный орган исполнительной власти'),
  ('00000000-0000-0000-0000-000000000000', 'Министерство цифрового развития, связи и массовых коммуникаций', 'Минцифры России', 'Федеральный орган исполнительной власти'),
  ('00000000-0000-0000-0000-000000000000', 'Центральный банк Российской Федерации', 'Банк России', 'Центральный банк РФ')
ON CONFLICT DO NOTHING;

-- Нормативные базы (не требуют tenant_id - глобальные справочники)
INSERT INTO regulatory_frameworks (code, name, short_name, category, authority, effective_date, badge_text, badge_color) VALUES
  ('152-FZ', 'Федеральный закон от 27.07.2006 № 152-ФЗ "О персональных данных"', '152-ФЗ', 'federal_law', 'Государственная Дума РФ', '2006-07-27', 'ПДн', 'blue'),
  ('187-FZ', 'Федеральный закон от 26.07.2017 № 187-ФЗ "О безопасности критической информационной инфраструктуры"', '187-ФЗ', 'federal_law', 'Государственная Дума РФ', '2017-07-26', 'КИИ', 'red'),
  ('FSTEC-239', 'Приказ ФСТЭК России от 25.12.2017 № 239', 'Приказ ФСТЭК №239', 'agency_order', 'ФСТЭК России', '2017-12-25', 'ФСТЭК', 'purple'),
  ('FSTEC-21', 'Приказ ФСТЭК России от 18.02.2013 № 21', 'Приказ ФСТЭК №21', 'agency_order', 'ФСТЭК России', '2013-02-18', 'ФСТЭК', 'purple'),
  ('FSB-378', 'Приказ ФСБ России от 10.07.2014 № 378', 'Приказ ФСБ №378', 'agency_order', 'ФСБ России', '2014-07-10', 'ФСБ', 'orange'),
  ('GOST-R-57580', 'ГОСТ Р 57580.1-2017', 'ГОСТ Р 57580.1-2017', 'standard', 'Росстандарт', '2017-06-01', 'ГОСТ', 'green'),
  ('149-FZ', 'Федеральный закон от 27.07.2006 № 149-ФЗ "Об информации"', '149-ФЗ', 'federal_law', 'Государственная Дума РФ', '2006-07-27', 'ИБ', 'gray')
ON CONFLICT (code) DO NOTHING;

-- Периодичность
INSERT INTO periodicities (tenant_id, code, name, description) VALUES
  ('00000000-0000-0000-0000-000000000000', 'continuous', 'Постоянно', 'Непрерывный контроль'),
  ('00000000-0000-0000-0000-000000000000', 'daily', 'Ежедневно', 'Проверка каждый день'),
  ('00000000-0000-0000-0000-000000000000', 'weekly', 'Еженедельно', 'Проверка раз в неделю'),
  ('00000000-0000-0000-0000-000000000000', 'monthly', 'Ежемесячно', 'Проверка раз в месяц'),
  ('00000000-0000-0000-0000-000000000000', 'quarterly', 'Ежеквартально', 'Проверка раз в квартал'),
  ('00000000-0000-0000-0000-000000000000', 'semi_annual', 'Раз в полгода', 'Проверка два раза в год'),
  ('00000000-0000-0000-0000-000000000000', 'annual', 'Ежегодно', 'Проверка раз в год'),
  ('00000000-0000-0000-0000-000000000000', 'on_demand', 'По требованию', 'Проверка по необходимости')
ON CONFLICT DO NOTHING;

-- Методы верификации
INSERT INTO verification_methods (tenant_id, code, name, description) VALUES
  ('00000000-0000-0000-0000-000000000000', 'document_review', 'Проверка документов', 'Анализ документации'),
  ('00000000-0000-0000-0000-000000000000', 'interview', 'Интервью', 'Опрос ответственных лиц'),
  ('00000000-0000-0000-0000-000000000000', 'observation', 'Наблюдение', 'Визуальная проверка'),
  ('00000000-0000-0000-0000-000000000000', 'testing', 'Тестирование', 'Технические тесты'),
  ('00000000-0000-0000-0000-000000000000', 'audit', 'Аудит', 'Комплексная проверка'),
  ('00000000-0000-0000-0000-000000000000', 'automated_scan', 'Автоматическое сканирование', 'Использование ПО для проверки')
ON CONFLICT DO NOTHING;

-- Ответственные роли
INSERT INTO responsible_roles (tenant_id, code, name, description) VALUES
  ('00000000-0000-0000-0000-000000000000', 'ib_manager', 'Руководитель ИБ', 'Ответственный за информационную безопасность'),
  ('00000000-0000-0000-0000-000000000000', 'it_manager', 'Руководитель ИТ', 'Начальник отдела информационных технологий'),
  ('00000000-0000-0000-0000-000000000000', 'security_officer', 'Офицер безопасности', 'Специалист по безопасности'),
  ('00000000-0000-0000-0000-000000000000', 'compliance_officer', 'Офицер комплаенса', 'Специалист по соответствию'),
  ('00000000-0000-0000-0000-000000000000', 'system_admin', 'Системный администратор', 'Администратор систем'),
  ('00000000-0000-0000-0000-000000000000', 'dpo', 'Ответственный за ПДн', 'Data Protection Officer')
ON CONFLICT DO NOTHING;

-- Категории требований
INSERT INTO requirement_categories (tenant_id, code, name, description) VALUES
  ('00000000-0000-0000-0000-000000000000', 'organizational', 'Организационные', 'Организационные меры защиты'),
  ('00000000-0000-0000-0000-000000000000', 'technical', 'Технические', 'Технические меры защиты'),
  ('00000000-0000-0000-0000-000000000000', 'physical', 'Физические', 'Физические меры защиты'),
  ('00000000-0000-0000-0000-000000000000', 'personnel', 'Кадровые', 'Кадровые меры защиты')
ON CONFLICT DO NOTHING;

-- Типы организаций (не требуют tenant_id - глобальные справочники)
INSERT INTO organization_types (code, name, description, icon, sort_order) VALUES
  ('regulator', 'Регулятор', 'Федеральный регулятор (ФСТЭК, ФСБ)', 'shield', 1),
  ('ministry', 'Министерство', 'Федеральное министерство', 'building', 2),
  ('department', 'Департамент', 'Департамент министерства', 'briefcase', 3),
  ('institution', 'Учреждение', 'Подведомственное учреждение', 'home', 4),
  ('branch', 'Филиал', 'Филиал учреждения', 'map-pin', 5)
ON CONFLICT (code) DO NOTHING;

-- =====================================================
-- 2. ТЕСТОВЫЕ ОРГАНИЗАЦИИ
-- =====================================================

-- Регулятор
INSERT INTO organizations (id, tenant_id, name, type, level) VALUES
  ('10000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000000', 'ФСТЭК России', 'regulator', 0)
ON CONFLICT (id) DO NOTHING;

-- Министерство
INSERT INTO organizations (id, tenant_id, name, type, parent_id, level) VALUES
  ('20000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000000', 'Министерство здравоохранения РФ', 'ministry', '10000000-0000-0000-0000-000000000001', 1)
ON CONFLICT (id) DO NOTHING;

-- Учреждения
INSERT INTO organizations (id, tenant_id, name, type, parent_id, level, has_pdn, has_kii) VALUES
  ('30000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000000', 'ФГБУ "Центральная клиническая больница"', 'institution', '20000000-0000-0000-0000-000000000001', 2, true, true),
  ('30000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000000', 'ФГБУ "Научный центр здоровья детей"', 'institution', '20000000-0000-0000-0000-000000000001', 2, true, false)
ON CONFLICT (id) DO NOTHING;

-- =====================================================
-- 3. ТИПОВЫЕ КОНТРОЛИ
-- =====================================================

INSERT INTO controls (tenant_id, code, title, description, category, control_type, frequency, is_automated) VALUES
  -- Организационные контроли
  ('00000000-0000-0000-0000-000000000000', 'ORG-001', 'Политика информационной безопасности', 'Разработка и утверждение политики ИБ организации', 'Организационные', 'preventive', 'annual', false),
  ('00000000-0000-0000-0000-000000000000', 'ORG-002', 'Назначение ответственного за ИБ', 'Приказ о назначении ответственного за обеспечение ИБ', 'Организационные', 'preventive', 'annual', false),
  ('00000000-0000-0000-0000-000000000000', 'ORG-003', 'Инструкция пользователей ИС', 'Инструкция по работе пользователей с информационными системами', 'Организационные', 'preventive', 'annual', false),
  ('00000000-0000-0000-0000-000000000000', 'ORG-004', 'Обучение персонала по ИБ', 'Проведение обучения и инструктажа персонала по вопросам ИБ', 'Организационные', 'preventive', 'quarterly', false),
  ('00000000-0000-0000-0000-000000000000', 'ORG-005', 'Аудит информационной безопасности', 'Проведение регулярных аудитов ИБ', 'Организационные', 'detective', 'annual', false),
  
  -- Технические контроли
  ('00000000-0000-0000-0000-000000000000', 'TECH-001', 'Антивирусная защита', 'Установка и обновление антивирусного ПО', 'Технические', 'preventive', 'continuous', true),
  ('00000000-0000-0000-0000-000000000000', 'TECH-002', 'Межсетевой экран', 'Установка и настройка межсетевого экрана', 'Технические', 'preventive', 'continuous', true),
  ('00000000-0000-0000-0000-000000000000', 'TECH-003', 'Система обнаружения вторжений', 'Внедрение СОВ для мониторинга сетевой активности', 'Технические', 'detective', 'continuous', true),
  ('00000000-0000-0000-0000-000000000000', 'TECH-004', 'Резервное копирование', 'Регулярное резервное копирование критичных данных', 'Технические', 'preventive', 'daily', true),
  ('00000000-0000-0000-0000-000000000000', 'TECH-005', 'Шифрование данных', 'Использование СКЗИ для шифрования конфиденциальных данных', 'Технические', 'preventive', 'continuous', true),
  ('00000000-0000-0000-0000-000000000000', 'TECH-006', 'Управление доступом', 'Система управления учетными записями и правами доступа', 'Технические', 'preventive', 'continuous', true),
  ('00000000-0000-0000-0000-000000000000', 'TECH-007', 'Журналирование событий', 'Регистрация событий безопасности в информационных системах', 'Технические', 'detective', 'continuous', true),
  ('00000000-0000-0000-0000-000000000000', 'TECH-008', 'Обновление ПО', 'Своевременная установка обновлений безопасности', 'Технические', 'preventive', 'weekly', true),
  
  -- Физические контроли
  ('00000000-0000-0000-0000-000000000000', 'PHYS-001', 'Контроль доступа в помещения', 'СКУД для контроля доступа в помещения с ИТ-инфраструктурой', 'Физические', 'preventive', 'continuous', true),
  ('00000000-0000-0000-0000-000000000000', 'PHYS-002', 'Видеонаблюдение', 'Система видеонаблюдения в критичных зонах', 'Физические', 'detective', 'continuous', true),
  ('00000000-0000-0000-0000-000000000000', 'PHYS-003', 'Охрана объекта', 'Физическая охрана объекта информатизации', 'Физические', 'preventive', 'continuous', false),
  ('00000000-0000-0000-0000-000000000000', 'PHYS-004', 'Защита от пожара', 'Система пожаротушения и пожарной сигнализации', 'Физические', 'preventive', 'continuous', true)
ON CONFLICT DO NOTHING;

-- =====================================================
-- SEED DATA LOADED SUCCESSFULLY
-- =====================================================
