-- Seed данные для Правительства Тульской области
-- Создание tenant, иерархии организаций и начальных данных

-- 1. Создание tenant для Тульской области
INSERT INTO tenants (id, name, slug, description, is_active, settings)
VALUES (
  '11111111-1111-1111-1111-111111111111',
  'Правительство Тульской области',
  'tula-region',
  'Органы исполнительной власти Тульской области',
  true,
  '{"region": "Тульская область", "timezone": "Europe/Moscow"}'::jsonb
)
ON CONFLICT (id) DO UPDATE SET
  name = EXCLUDED.name,
  description = EXCLUDED.description,
  updated_at = NOW();

-- 2. Создание типов организаций (если еще не созданы)
INSERT INTO organization_types (code, name, description, icon, sort_order) VALUES
  ('government', 'Правительство', 'Правительство региона', 'Landmark', 5),
  ('ministry', 'Министерство', 'Министерство региона', 'Building2', 10),
  ('department', 'Департамент', 'Департамент или управление', 'Building', 20),
  ('hospital', 'Медицинское учреждение', 'Больница, поликлиника', 'Hospital', 70),
  ('school', 'Образовательное учреждение', 'Школа, лицей, гимназия', 'School', 80),
  ('municipality', 'Муниципалитет', 'Муниципальное образование', 'MapPin', 90)
ON CONFLICT (code) DO NOTHING;

-- Удаляем существующие организации Тульской области перед созданием новых
DELETE FROM organization_attributes WHERE organization_id IN (
  SELECT id FROM organizations WHERE tenant_id = '11111111-1111-1111-1111-111111111111'
);
DELETE FROM organizations WHERE tenant_id = '11111111-1111-1111-1111-111111111111';

-- 3. Создание корневой организации - Правительство Тульской области
INSERT INTO organizations (
  id, tenant_id, name, type_id, parent_id, level, 
  is_active, is_government, description,
  address, inn, ogrn
) VALUES (
  '10000000-0000-0000-0000-000000000001',
  '11111111-1111-1111-1111-111111111111',
  'Правительство Тульской области',
  (SELECT id FROM organization_types WHERE code = 'government'),
  NULL,
  1,
  true,
  true,
  'Высший исполнительный орган государственной власти Тульской области',
  'г. Тула, пр. Ленина, д. 2',
  '7107001953',
  '1027100575576'
);

-- 4. Министерство здравоохранения Тульской области
INSERT INTO organizations (
  id, tenant_id, name, type_id, parent_id, level,
  is_active, is_government, is_healthcare, description,
  address, contact_person_name
) VALUES (
  '10000000-0000-0000-0000-000000000010',
  '11111111-1111-1111-1111-111111111111',
  'Министерство здравоохранения Тульской области',
  (SELECT id FROM organization_types WHERE code = 'ministry'),
  '10000000-0000-0000-0000-000000000001',
  2,
  true,
  true,
  true,
  'Орган исполнительной власти Тульской области в сфере здравоохранения',
  'г. Тула, ул. Пирогова, д. 21',
  'Министр здравоохранения'
);

-- 5. Больницы Тульской области
INSERT INTO organizations (
  id, tenant_id, name, type_id, parent_id, level,
  is_active, is_government, is_healthcare, has_pdn, description,
  address
) VALUES 
  (
    '10000000-0000-0000-0000-000000000011',
    '11111111-1111-1111-1111-111111111111',
    'ГУЗ "Алексинская районная больница №1 имени профессора В.Ф. Снегирева"',
    (SELECT id FROM organization_types WHERE code = 'hospital'),
    '10000000-0000-0000-0000-000000000010',
    3,
    true,
    true,
    true,
    true,
    'Многопрофильное лечебное учреждение Алексинского района',
    'г. Алексин, ул. Больничная, д. 1'
  ),
  (
    '10000000-0000-0000-0000-000000000012',
    '11111111-1111-1111-1111-111111111111',
    'ГУЗ ТО "Территориальный центр медицины катастроф"',
    (SELECT id FROM organization_types WHERE code = 'hospital'),
    '10000000-0000-0000-0000-000000000010',
    3,
    true,
    true,
    true,
    true,
    'Центр экстренной и неотложной медицинской помощи',
    'г. Тула, Красноармейский пр., д. 1'
  ),
  (
    '10000000-0000-0000-0000-000000000013',
    '11111111-1111-1111-1111-111111111111',
    'ГУЗ "Тульская городская клиническая больница скорой медицинской помощи им. Д.Я. Ваныкина"',
    (SELECT id FROM organization_types WHERE code = 'hospital'),
    '10000000-0000-0000-0000-000000000010',
    3,
    true,
    true,
    true,
    true,
    'Многопрофильная больница скорой медицинской помощи',
    'г. Тула, ул. Первомайская, д. 13'
  ),
  (
    '10000000-0000-0000-0000-000000000014',
    '11111111-1111-1111-1111-111111111111',
    'ГУЗ "Тульская областная клиническая больница"',
    (SELECT id FROM organization_types WHERE code = 'hospital'),
    '10000000-0000-0000-0000-000000000010',
    3,
    true,
    true,
    true,
    true,
    'Крупнейшее многопрофильное лечебное учреждение региона',
    'г. Тула, ул. Яблочкова, д. 1а'
  );

-- 6. Министерство образования Тульской области
INSERT INTO organizations (
  id, tenant_id, name, type_id, parent_id, level,
  is_active, is_government, description,
  address, contact_person_name
) VALUES (
  '10000000-0000-0000-0000-000000000020',
  '11111111-1111-1111-1111-111111111111',
  'Министерство образования Тульской области',
  (SELECT id FROM organization_types WHERE code = 'ministry'),
  '10000000-0000-0000-0000-000000000001',
  2,
  true,
  true,
  'Орган исполнительной власти Тульской области в сфере образования',
  'г. Тула, пр. Ленина, д. 22',
  'Министр образования'
);

-- 7. Школы города Тулы
INSERT INTO organizations (
  id, tenant_id, name, type_id, parent_id, level,
  is_active, is_government, has_pdn, description,
  address
) VALUES 
  (
    '10000000-0000-0000-0000-000000000021',
    '11111111-1111-1111-1111-111111111111',
    'МБОУ "Центр образования №2 имени Героя Советского Союза Олега Петровича Матвеева"',
    (SELECT id FROM organization_types WHERE code = 'school'),
    '10000000-0000-0000-0000-000000000020',
    3,
    true,
    true,
    true,
    'Общеобразовательное учреждение города Тулы',
    'г. Тула, ул. Революции, д. 1'
  ),
  (
    '10000000-0000-0000-0000-000000000022',
    '11111111-1111-1111-1111-111111111111',
    'МБОУ "Центр образования №5 имени Героя Российской Федерации Сергея Сергеевича Громова"',
    (SELECT id FROM organization_types WHERE code = 'school'),
    '10000000-0000-0000-0000-000000000020',
    3,
    true,
    true,
    true,
    'Общеобразовательное учреждение города Тулы',
    'г. Тула, ул. Ложевая, д. 123'
  ),
  (
    '10000000-0000-0000-0000-000000000023',
    '11111111-1111-1111-1111-111111111111',
    'МБОУ "Центр образования №7 имени Героя Советского Союза Сергея Николаевича Судейского"',
    (SELECT id FROM organization_types WHERE code = 'school'),
    '10000000-0000-0000-0000-000000000020',
    3,
    true,
    true,
    true,
    'Общеобразовательное учреждение города Тулы',
    'г. Тула, ул. Металлургов, д. 47'
  ),
  (
    '10000000-0000-0000-0000-000000000024',
    '11111111-1111-1111-1111-111111111111',
    'МБОУ "Центр образования №10 имени А.В. Чернова"',
    (SELECT id FROM organization_types WHERE code = 'school'),
    '10000000-0000-0000-0000-000000000020',
    3,
    true,
    true,
    true,
    'Общеобразовательное учреждение города Тулы',
    'г. Тула, ул. Мосина, д. 1'
  ),
  (
    '10000000-0000-0000-0000-000000000025',
    '11111111-1111-1111-1111-111111111111',
    'МБОУ "Центр образования №12"',
    (SELECT id FROM organization_types WHERE code = 'school'),
    '10000000-0000-0000-0000-000000000020',
    3,
    true,
    true,
    true,
    'Общеобразовательное учреждение города Тулы',
    'г. Тула, ул. Кирова, д. 165а'
  ),
  (
    '10000000-0000-0000-0000-000000000026',
    '11111111-1111-1111-1111-111111111111',
    'МБОУ "Лицей №2 имени Бориса Анатольевича Слободскова"',
    (SELECT id FROM organization_types WHERE code = 'school'),
    '10000000-0000-0000-0000-000000000020',
    3,
    true,
    true,
    true,
    'Лицей с углубленным изучением предметов',
    'г. Тула, ул. Октябрьская, д. 105'
  );

-- 8. Муниципальные образования Тульской области
INSERT INTO organizations (
  id, tenant_id, name, type_id, parent_id, level,
  is_active, is_government, description,
  address
) VALUES 
  (
    '10000000-0000-0000-0000-000000000030',
    '11111111-1111-1111-1111-111111111111',
    'Администрация города Тулы',
    (SELECT id FROM organization_types WHERE code = 'municipality'),
    '10000000-0000-0000-0000-000000000001',
    2,
    true,
    true,
    'Муниципальное образование город Тула',
    'г. Тула, пр. Ленина, д. 2'
  ),
  (
    '10000000-0000-0000-0000-000000000031',
    '11111111-1111-1111-1111-111111111111',
    'Администрация Алексинского района',
    (SELECT id FROM organization_types WHERE code = 'municipality'),
    '10000000-0000-0000-0000-000000000001',
    2,
    true,
    true,
    'Муниципальное образование Алексинский район',
    'г. Алексин, ул. Советская, д. 2'
  ),
  (
    '10000000-0000-0000-0000-000000000032',
    '11111111-1111-1111-1111-111111111111',
    'Администрация Новомосковского района',
    (SELECT id FROM organization_types WHERE code = 'municipality'),
    '10000000-0000-0000-0000-000000000001',
    2,
    true,
    true,
    'Муниципальное образование Новомосковский район',
    'г. Новомосковск, пр. Комсомольский, д. 8'
  ),
  (
    '10000000-0000-0000-0000-000000000033',
    '11111111-1111-1111-1111-111111111111',
    'Администрация Щекинского района',
    (SELECT id FROM organization_types WHERE code = 'municipality'),
    '10000000-0000-0000-0000-000000000001',
    2,
    true,
    true,
    'Муниципальное образование Щекинский район',
    'г. Щекино, ул. Советская, д. 47'
  );

-- 9. Создание атрибутов для организаций
INSERT INTO organization_attributes (
  organization_id, tenant_id,
  kii_category, pdn_level, 
  is_financial, is_healthcare, is_government,
  employee_count, has_foreign_data
) VALUES
  -- Правительство
  ('10000000-0000-0000-0000-000000000001', '11111111-1111-1111-1111-111111111111',
   1, 1, false, false, true, 500, false),
  
  -- Минздрав
  ('10000000-0000-0000-0000-000000000010', '11111111-1111-1111-1111-111111111111',
   1, 1, false, true, true, 150, false),
  
  -- Больницы (КИИ категория 2, ПДн уровень 1)
  ('10000000-0000-0000-0000-000000000011', '11111111-1111-1111-1111-111111111111',
   2, 1, false, true, true, 300, false),
  ('10000000-0000-0000-0000-000000000012', '11111111-1111-1111-1111-111111111111',
   2, 1, false, true, true, 200, false),
  ('10000000-0000-0000-0000-000000000013', '11111111-1111-1111-1111-111111111111',
   2, 1, false, true, true, 450, false),
  ('10000000-0000-0000-0000-000000000014', '11111111-1111-1111-1111-111111111111',
   2, 1, false, true, true, 800, false),
  
  -- Минобр
  ('10000000-0000-0000-0000-000000000020', '11111111-1111-1111-1111-111111111111',
   1, 1, false, false, true, 100, false),
  
  -- Школы (ПДн уровень 2 - обработка данных детей)
  ('10000000-0000-0000-0000-000000000021', '11111111-1111-1111-1111-111111111111',
   NULL, 2, false, false, true, 80, false),
  ('10000000-0000-0000-0000-000000000022', '11111111-1111-1111-1111-111111111111',
   NULL, 2, false, false, true, 75, false),
  ('10000000-0000-0000-0000-000000000023', '11111111-1111-1111-1111-111111111111',
   NULL, 2, false, false, true, 70, false),
  ('10000000-0000-0000-0000-000000000024', '11111111-1111-1111-1111-111111111111',
   NULL, 2, false, false, true, 65, false),
  ('10000000-0000-0000-0000-000000000025', '11111111-1111-1111-1111-111111111111',
   NULL, 2, false, false, true, 60, false),
  ('10000000-0000-0000-0000-000000000026', '11111111-1111-1111-1111-111111111111',
   NULL, 2, false, false, true, 90, false),
  
  -- Муниципалитеты
  ('10000000-0000-0000-0000-000000000030', '11111111-1111-1111-1111-111111111111',
   1, 1, false, false, true, 400, false),
  ('10000000-0000-0000-0000-000000000031', '11111111-1111-1111-1111-111111111111',
   NULL, 1, false, false, true, 150, false),
  ('10000000-0000-0000-0000-000000000032', '11111111-1111-1111-1111-111111111111',
   NULL, 1, false, false, true, 180, false),
  ('10000000-0000-0000-0000-000000000033', '11111111-1111-1111-1111-111111111111',
   NULL, 1, false, false, true, 160, false);

-- 10. Вывод результата
SELECT 
  'Seed данные для Тульской области успешно созданы' as status,
  COUNT(*) as organizations_count
FROM organizations 
WHERE tenant_id = '11111111-1111-1111-1111-111111111111';

-- 11. Вывод иерархии организаций
SELECT 
  REPEAT('  ', level - 1) || o.name as organization_hierarchy,
  ot.name as type_name,
  level
FROM organizations o
LEFT JOIN organization_types ot ON o.type_id = ot.id
WHERE o.tenant_id = '11111111-1111-1111-1111-111111111111'
ORDER BY level, o.name;
